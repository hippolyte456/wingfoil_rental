{% extends 'base.html' %}
{% from 'includes/seo_tags.html' import render_meta_tags, render_structured_data %}
{% block title %}Wing4All - Réseau de location de Wingfoil en France{% endblock %}

{% block seo %}
    {{ render_meta_tags(meta_tags) }}
    {% if structured_data %}
        {{ render_structured_data(structured_data) }}
    {% endif %}
{% endblock %}

{% block head %}
    <!-- Inclure les fichiers CSS de Leaflet -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
          integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
          crossorigin=""/>
{% endblock %}

{% block content %}
<section class="hero bg-primary text-white py-5">
    <div class="container">
        <div class="row align-items-center">
            <div class="col-lg-7">
                <h1 class="display-4 mb-4">Wing4All - Le réseau de location de Wingfoil en France</h1>
                <p class="lead">Découvrez nos points de location dans les meilleurs spots de wingfoil</p>
                <p>Matériel de qualité, conseils personnalisés et services adaptés à tous les niveaux</p>
            </div>
            <div class="col-lg-5">
                <img src="{{ url_for('static', filename='img/logo/logo_wingfoil-rm-bg.png') }}" alt="Logo Wing4All" class="img-fluid">
            </div>
        </div>
    </div>
</section>

<section class="locations py-5">
    <div class="container">
        <h2 class="text-center mb-5">Nos emplacements Wing4All</h2>
        
        <div class="row mb-4">
            <div class="col-12">
                <div id="map" style="height: 500px; width: 100%;"></div>
            </div>
        </div>
        
        <div class="row">
            {% for site in sites %}
                <div class="col-md-6 col-lg-4 mb-4">
                    <div class="card h-100">
                        <div class="card-body">
                            <h3 class="card-title">{{ site.name }}</h3>
                            <p class="card-text">{{ site.description }}</p>
                            <p><strong>Adresse:</strong> {{ site.address }}, {{ site.postal_code }} {{ site.city }}</p>
                            <p><strong>Contact:</strong> {{ site.phone }}</p>
                            <a href="{{ url_for('main.site_home', site_slug=site.slug) }}" class="btn btn-primary">Voir ce site</a>
                        </div>
                    </div>
                </div>
            {% endfor %}
        </div>
    </div>
</section>

<section class="why-us py-5 bg-light">
    <div class="container">
        <h2 class="text-center mb-5">Pourquoi choisir Wing4All ?</h2>
        
        <div class="row">
            <div class="col-md-4 mb-4">
                <div class="card h-100">
                    <div class="card-body text-center">
                        <i class="fas fa-medal fa-3x mb-3 text-primary"></i>
                        <h3>Qualité et sécurité</h3>
                        <p>Matériel récent, régulièrement entretenu pour une pratique en toute sécurité</p>
                    </div>
                </div>
            </div>
            
            <div class="col-md-4 mb-4">
                <div class="card h-100">
                    <div class="card-body text-center">
                        <i class="fas fa-user-friends fa-3x mb-3 text-primary"></i>
                        <h3>Coaching personnalisé</h3>
                        <p>Moniteurs FFV diplômés pour vous accompagner dans votre progression</p>
                    </div>
                </div>
            </div>
            
            <div class="col-md-4 mb-4">
                <div class="card h-100">
                    <div class="card-body text-center">
                        <i class="fas fa-map-marked-alt fa-3x mb-3 text-primary"></i>
                        <h3>Spots exceptionnels</h3>
                        <p>Des emplacements choisis pour leurs conditions optimales de pratique</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<section class="join-us py-5">
    <div class="container">
        <h2 class="text-center mb-5">Rejoindre le réseau Wing4All</h2>
        <div class="row justify-content-center">
            <div class="col-md-8">
                <div class="card">
                    <div class="card-body">
                        <p>Vous êtes passionné de wingfoil et souhaitez ouvrir une franchise Wing4All dans votre région ? Contactez-nous pour découvrir les opportunités d'affaires et bénéficier de notre expertise.</p>
                        <div class="text-center">
                            <a href="{{ url_for('main.contact') }}" class="btn btn-primary">Nous contacter</a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

{% endblock %}

{% block scripts %}
<!-- Inclure le script de Leaflet -->
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
        integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
        crossorigin=""></script>
<script>
    // Script pour initialiser la carte avec les marqueurs des sites
    function initMap() {
        // Coordonnées centrales pour la France
        var franceCenter = [46.603354, 1.888334];
        
        console.log('Initialisation de la carte...');
        
        // Création de la carte
        var map = L.map('map').setView(franceCenter, 6);
        
        // Ajout de la couche OpenStreetMap
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
        }).addTo(map);
        
        // Récupération des sites depuis les données transmises par le backend
        var sitesData = {{ sites_json | safe }};
        console.log('Données des sites reçues:', sitesData);
        
        // Vérifier que nous avons des sites à afficher
        if (!sitesData || sitesData.length === 0) {
            console.error('Aucun site avec coordonnées valides à afficher.');
            return;
        }
        
        // Ajout des marqueurs pour chaque site
        sitesData.forEach(function(site) {
            console.log('Ajout du marqueur pour:', site.name, 'à la position:', site.lat, site.lng);
            try {
                var marker = L.marker([site.lat, site.lng])
                    .addTo(map)
                    .bindPopup(
                        '<div class="site-popup">' + 
                            '<h5>' + site.name + '</h5>' + 
                            '<p>' + site.description + '</p>' +
                            '<p><a href="/site/' + site.slug + '" class="btn btn-sm btn-primary">Visiter ce site</a></p>' +
                        '</div>'
                    );
            } catch (error) {
                console.error('Erreur lors de l\'ajout du marqueur pour', site.name, ':', error);
            }
        });
    }
    
    // Initialisation de la carte au chargement de la page
    document.addEventListener('DOMContentLoaded', function() {
        try {
            initMap();
        } catch (error) {
            console.error('Erreur lors de l\'initialisation de la carte:', error);
        }
    });
</script>
{% endblock %}