{% extends "admin/base_admin.html" %}

{% block title %}Tableau de bord{% endblock %}

{% block content %}
<div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
    <h1 class="h2">Tableau de bord</h1>
</div>

<div class="row mb-4">
    <div class="col-lg-3 col-md-6 mb-4">
        <div class="card bg-primary text-white stat-card">
            <div class="card-body">
                <div class="d-flex justify-content-between align-items-center">
                    <div>
                        <h6 class="text-uppercase mb-0">Utilisateurs</h6>
                        <h2 class="mb-0">{{ stats.users_count }}</h2>
                    </div>
                    <i class="fas fa-users fa-3x"></i>
                </div>
            </div>
            <div class="card-footer d-flex align-items-center justify-content-between">
                <a href="{{ url_for('admin.users_list') }}" class="text-white">Voir détails</a>
                <i class="fas fa-angle-right text-white"></i>
            </div>
        </div>
    </div>

    <div class="col-lg-3 col-md-6 mb-4">
        <div class="card bg-success text-white stat-card">
            <div class="card-body">
                <div class="d-flex justify-content-between align-items-center">
                    <div>
                        <h6 class="text-uppercase mb-0">Sites</h6>
                        <h2 class="mb-0">{{ stats.sites_count }}</h2>
                    </div>
                    <i class="fas fa-map-marked-alt fa-3x"></i>
                </div>
            </div>
            <div class="card-footer d-flex align-items-center justify-content-between">
                <a href="{{ url_for('admin.sites_list') }}" class="text-white">Voir détails</a>
                <i class="fas fa-angle-right text-white"></i>
            </div>
        </div>
    </div>

    <div class="col-lg-3 col-md-6 mb-4">
        <div class="card bg-info text-white stat-card">
            <div class="card-body">
                <div class="d-flex justify-content-between align-items-center">
                    <div>
                        <h6 class="text-uppercase mb-0">Équipements</h6>
                        <h2 class="mb-0">{{ stats.equipment_count }}</h2>
                    </div>
                    <i class="fas fa-wind fa-3x"></i>
                </div>
            </div>
            <div class="card-footer d-flex align-items-center justify-content-between">
                <a href="{{ url_for('admin.equipment_list') }}" class="text-white">Voir détails</a>
                <i class="fas fa-angle-right text-white"></i>
            </div>
        </div>
    </div>

    <div class="col-lg-3 col-md-6 mb-4">
        <div class="card bg-warning text-white stat-card">
            <div class="card-body">
                <div class="d-flex justify-content-between align-items-center">
                    <div>
                        <h6 class="text-uppercase mb-0">Réservations</h6>
                        <h2 class="mb-0">{{ stats.reservations_count }}</h2>
                    </div>
                    <i class="fas fa-calendar-alt fa-3x"></i>
                </div>
            </div>
            <div class="card-footer d-flex align-items-center justify-content-between">
                <a href="{{ url_for('admin.reservations_list') }}" class="text-white">Voir détails</a>
                <i class="fas fa-angle-right text-white"></i>
            </div>
        </div>
    </div>
</div>

<div class="row">
    <div class="col-md-6 mb-4">
        <div class="card">
            <div class="card-header">
                <h5 class="card-title mb-0">Réservations en attente</h5>
            </div>
            <div class="card-body">
                <h2 class="text-warning">{{ stats.pending_reservations }}</h2>
                <p>Réservations nécessitant votre attention.</p>
                <a href="{{ url_for('admin.reservations_list') }}" class="btn btn-primary">Gérer les réservations</a>
            </div>
        </div>
    </div>
    
    <div class="col-md-6 mb-4">
        <div class="card">
            <div class="card-header">
                <h5 class="card-title mb-0">Actions rapides</h5>
            </div>
            <div class="card-body">
                <div class="d-grid gap-2">
                    <a href="{{ url_for('admin.user_create') }}" class="btn btn-outline-primary">
                        <i class="fas fa-user-plus me-2"></i> Ajouter un utilisateur
                    </a>
                    <a href="{{ url_for('admin.site_create') }}" class="btn btn-outline-success">
                        <i class="fas fa-map-marker-alt me-2"></i> Ajouter un site
                    </a>
                    <a href="{{ url_for('admin.equipment_create') }}" class="btn btn-outline-info">
                        <i class="fas fa-plus-circle me-2"></i> Ajouter un équipement
                    </a>
                    <a href="{{ url_for('admin.reservation_create') }}" class="btn btn-outline-warning">
                        <i class="fas fa-calendar-plus me-2"></i> Créer une réservation
                    </a>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
    // Script pour actualiser les statistiques toutes les 30 secondes
    function refreshStats() {
        fetch('/admin/api/stats')
            .then(response => response.json())
            .then(data => {
                document.querySelector('.bg-primary .card-body h2').textContent = data.users_count;
                document.querySelector('.bg-success .card-body h2').textContent = data.sites_count;
                document.querySelector('.bg-info .card-body h2').textContent = data.equipment_count;
                document.querySelector('.bg-warning .card-body h2').textContent = data.reservations_count;
                document.querySelector('.card-body h2.text-warning').textContent = data.pending_reservations;
            })
            .catch(error => console.error('Erreur lors de l\'actualisation des statistiques:', error));
    }

    // Actualisation des statistiques toutes les 30 secondes
    setInterval(refreshStats, 30000);
</script>
{% endblock %}